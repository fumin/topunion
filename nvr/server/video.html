<!DOCTYPE html>
<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.12/hls.js"></script>
</head>
<body>
<div id="info"></div>
<video id="video" controls mute autoplay style="max-width: 100%; max-height: 98vh;"></video>

<script>
let page = {{.}};

let video = document.querySelector("#video");
if (Hls.isSupported()) {
	let config = {
		liveSyncDurationCount: 1,
		liveMaxLatencyDurationCount: 5,
		liveDurationInfinity: true,
	};
	let hls = new Hls(config);
	hls.on(Hls.Events.ERROR, function(event, data){
		let errorType = data.type;
		let errorDetails = data.details;
		let errorFatal = data.fatal;
		console.log(errorType, errorDetails, errorFatal, event, data);

		if (errorFatal) {
			switch (errorDetails) {
			case Hls.ErrorDetails.MANIFEST_LOAD_ERROR:
			case Hls.ErrorDetails.LEVEL_EMPTY_ERROR:
				let secs = 1;
				setTimeout(function(){
					window.location.reload();
				}, secs*1000);
			}
		}
	});
	hls.loadSource(page.Src);
	hls.attachMedia(video);
} else if (video.canPlayType("application/vnd.apple.mpegurl")) {
	video.src = page.Src;
} else {
	let info = document.querySelector("#info");
	info.textContent = "Your browser does not support HLS.";
}
</script>
</body>
</html>
